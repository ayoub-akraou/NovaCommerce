model Order {
  id                String      @id @default(cuid())
  orderNumber       Int         @unique @default(autoincrement())
  userId            String
  status            OrderStatus @default(PENDING)
  subtotal          Decimal     @db.Decimal(10, 2)
  shippingFee       Decimal     @default(0) @db.Decimal(10, 2)
  discountTotal     Decimal     @default(0) @db.Decimal(10, 2)
  taxTotal          Decimal     @default(0) @db.Decimal(10, 2)
  total             Decimal     @db.Decimal(10, 2)
  currency          String      @default("EUR")
  shippingAddressId String?
  billingAddressId  String?
  notes             String?
  paidAt            DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  user            User     @relation(fields: [userId], references: [id], onDelete: Restrict)
  shippingAddress Address? @relation("OrderShippingAddress", fields: [shippingAddressId], references: [id], onDelete: SetNull)
  billingAddress  Address? @relation("OrderBillingAddress", fields: [billingAddressId], references: [id], onDelete: SetNull)
  items           OrderItem[]
  payments        Payment[]

  @@index([userId, status])
  @@index([createdAt])
}

model OrderItem {
  orderId          String
  productId        String
  quantity         Int
  unitPrice        Decimal  @db.Decimal(10, 2)
  priceAtPurchase  Decimal  @db.Decimal(10, 2)
  titleSnapshot    String
  slugSnapshot     String
  createdAt        DateTime @default(now())

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Restrict)

  @@id([orderId, productId])
  @@index([productId])
}
